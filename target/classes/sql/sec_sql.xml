<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<sqlRoot>

  <sqlGroup name="user">
  	<sql id="findUserPageBySelect">SELECT `user`.* 
    </sql>
    <sql id="findUserPageByFrom">FROM `sec_user` user 
    </sql>
    
    <!-- 查询用户所有信息 -->
    <sql id="findInfoBySelect">
		select u.id userid,u.username account,u.providername providernme,
		u.email email,u.phone phone,u.password psw,
		u.hasher hasher,u.salt salt,u.avatar_url avatat,
		u.first_name firstname,u.last_name lastname,u.full_name fullname,
		u.created_at createtime,u.updated_at updatetime,u.deleted_at deletetime,
		s.id info_id,s.user_id info_userid,s.branch_id info_branchid,s.creator_id info_creator,s.gender gender,
    	s.created_at info_createtime,s.updated_at info_updatetime,s.deleted_at info_deletetime,
		c.id branchid,c.name branch,
    	c.created_at branch_createtime,c.updated_at branch_updatetime,c.deleted_at branch_deletetime
    </sql>
    <sql id="findInfoByFrom">
    	from sec_user_info as s 
		left outer join com_branch as c on s.branch_id=c.id
		left outer join sec_user as u on s.user_id=u.id 
		where u.id=?
    </sql>
    
    <!-- 根据用户id，查询用户所属公司 -->
  	
  	<sql id="findUserBranchBySelect">
  		SELECT  bra.name branch
  	</sql>
  	<sql id="findUserBranchByFrom">
  		FROM sec_user_info AS info
		LEFT OUTER JOIN sec_user AS u ON info.user_id=u.id
		LEFT OUTER JOIN com_branch AS bra ON info.branch_id=bra.id
		WHERE info.user_id=?
  	</sql>
  	
  	<!-- 根据故障类型，查找运维人员的信息 -->
  	<sql id="findOperatorBySelect">
  		SELECT u.id userid,u.email useremail,u.phone userphone,
		u.first_name firstname,u.last_name lastname,u.full_name fullname
  	</sql>
  	<sql id="findOperatorByFrom">
  		FROM sec_user AS u
		WHERE u.id 
		IN(SELECT cut.user_id 
			 FROM com_user_type AS cut 
			 WHERE cut.type_id=?)
  	</sql>
  	
  </sqlGroup>

  <sqlGroup name="role">
    <sql id="findUserByFrom">FROM sec_role `role` WHERE `role`.id IN (SELECT `userRole`.role_id FROM
      sec_user_role `userRole` WHERE `userRole`.user_id=?)
    </sql>
    <!--需要一个参数-->
    <sql id="findChildrenByFrom">FROM sec_role `role`
      INNER JOIN (SELECT left_code,right_code FROM sec_role WHERE id=?) `code` ON (`role`.left_code
      &gt; `code`.left_code AND
      `role`.right_code &lt;
      `code`.right_code)
    </sql>
  </sqlGroup>

  <sqlGroup name="userRole">
  	<sql>FROM sec_user_role `userRole` 
  	
  	</sql>
  </sqlGroup>

  <sqlGroup name="permission">
    <sql id="findRoleByFrom">FROM sec_permission `permission` WHERE `permission`.id IN (SELECT
      `role_permission`.permission_id FROM sec_role_permission
      `role_permission` WHERE `role_permission`.role_id=?)
    </sql>
  </sqlGroup>

  <sqlGroup name="rolePermission">

  </sqlGroup>
</sqlRoot>